<div class="section items-section">

  <!-- ESTADO VACÃO -->
  <div
    *ngIf="items.length === 0"
    class="empty-items"
    (click)="onAddItems()"
  >
    <mat-icon>shopping_cart</mat-icon>
    <p>No hay productos en el pedido</p>
    <span>Agregar productos</span>
  </div>

  <!-- TABLA (solo si hay items) -->
  <ng-container *ngIf="items.length > 0">
    <table
      mat-table
      [dataSource]="dataSource"
      class="mat-elevation-z1"
    >

      <!-- PRODUCTO -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Producto</th>
        <td mat-cell *matCellDef="let item">
          {{ item.name }}
        </td>
      </ng-container>

      <!-- CANTIDAD -->
      <ng-container matColumnDef="qty">
        <th mat-header-cell *matHeaderCellDef>Cantidad</th>
        <td mat-cell *matCellDef="let item">
          <input
            type="number"
            min="1"
            [(ngModel)]="item.qty"
            (ngModelChange)="onQuantityChange()"
            class="input-quantity form-control"
          />
        </td>
      </ng-container>

      <!-- PRECIO -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Precio</th>
        <td mat-cell *matCellDef="let item">
          {{ item.price | currency }}
        </td>
      </ng-container>

      <!-- SUBTOTAL -->
      <ng-container matColumnDef="subtotal">
        <th mat-header-cell *matHeaderCellDef>Subtotal</th>
        <td mat-cell *matCellDef="let item">
          {{ item.price * item.qty | currency }}
        </td>
      </ng-container>

      <!-- ACCIONES -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let item; let i = index">
          <button
            mat-icon-button
            color="warn"
            (click)="onRemove(i)"
          >
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <!-- COLUMNA FOOTER (AGREGAR) -->
      <ng-container matColumnDef="add">
        <td
          mat-footer-cell
          *matFooterCellDef
          class="add-items-row"
          [attr.colspan]="displayedColumns.length"
          (click)="onAddItems()"
        >
          <mat-icon>add</mat-icon>
          <span>Agregar producto</span>
        </td>
      </ng-container>

      <!-- FILAS -->
      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

      <!-- FILA INVISIBLE POS -->
      <tr mat-footer-row *matFooterRowDef="['add']"></tr>
    </table>
  </ng-container>
</div>
