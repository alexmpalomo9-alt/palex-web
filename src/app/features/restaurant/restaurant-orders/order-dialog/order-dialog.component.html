<mat-dialog-content class="order-dialog-content">
  <!-- Header con título y botón -->
  <div class="order-dialog-header">
    <h2>Pedido Mesa #{{ tableNumber }}</h2>
    <button mat-raised-button color="primary" (click)="addItemDialog()">
      Agregar producto
    </button>
  </div>

  <!-- Loader -->
  <div *ngIf="loading" class="loading-container">
    <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
  </div>

  <ng-container *ngIf="!loading">
    <!-- Tabla para desktop -->
    <table
      mat-table
      [dataSource]="items"
      class="full-width desktop-table"
      *ngIf="!isMobile"
    >
      <!-- Producto -->
      <ng-container matColumnDef="name">
        <th mat-header-cell *matHeaderCellDef>Producto</th>
        <td mat-cell *matCellDef="let item">{{ item.name }}</td>
      </ng-container>

      <!-- Cantidad -->
      <ng-container matColumnDef="qty">
        <th mat-header-cell *matHeaderCellDef>Cantidad</th>
        <td mat-cell *matCellDef="let item">
          <input type="number" min="1" [(ngModel)]="item.qty" />
        </td>
      </ng-container>

      <!-- Precio -->
      <ng-container matColumnDef="price">
        <th mat-header-cell *matHeaderCellDef>Precio</th>
        <td mat-cell *matCellDef="let item">{{ item.price | currency }}</td>
      </ng-container>

      <!-- Subtotal -->
      <ng-container matColumnDef="subtotal">
        <th mat-header-cell *matHeaderCellDef>Subtotal</th>
        <td mat-cell *matCellDef="let item">
          {{ item.price * item.qty | currency }}
        </td>
      </ng-container>

      <!-- Notas -->
      <ng-container matColumnDef="notes">
        <th mat-header-cell *matHeaderCellDef>Notas</th>
        <td mat-cell *matCellDef="let item">
          <input type="text" [(ngModel)]="item.notes" placeholder="Opcional" />
        </td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef>Acciones</th>
        <td mat-cell *matCellDef="let item; let i = index">
          <button mat-icon-button color="warn" (click)="removeItem(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </td>
      </ng-container>

      <tr
        mat-header-row
        *matHeaderRowDef="[ 'name', 'qty', 'price', 'subtotal', 'notes', 'actions' ]"
      ></tr>
      <tr
        mat-row
        *matRowDef="let row; columns: ['name', 'qty', 'price', 'subtotal', 'notes', 'actions']"
      ></tr>
    </table>

    <!-- Cards para mobile -->
    <div *ngIf="isMobile" class="mobile-items">
      <div *ngFor="let item of items; let i = index" class="mobile-item-card">
        <div class="card-header">
          <strong>{{ item.name }}</strong>
          <button mat-icon-button color="warn" (click)="removeItem(i)">
            <mat-icon>delete</mat-icon>
          </button>
        </div>
        <div>Cantidad: <input type="number" min="1" [(ngModel)]="item.qty" /></div>
        <div>Precio: {{ item.price | currency }}</div>
        <div>Subtotal: {{ item.price * item.qty | currency }}</div>
        <div>
          Notas:
          <input type="text" [(ngModel)]="item.notes" placeholder="Opcional" />
        </div>
      </div>
    </div>

    <!-- Notas generales del pedido -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Notas del pedido</mat-label>
      <textarea matInput [(ngModel)]="notes" rows="3"></textarea>
    </mat-form-field>

    <!-- Total -->
    <div class="order-total">
      <strong>Total: </strong> {{ getTotal() | currency }}
    </div>
  </ng-container>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="cancel()">Cancelar</button>

  <!-- Botón Crear pedido -->
  <button
    mat-raised-button
    color="accent"
    *ngIf="!isEditMode && status !== 'closed'"
    (click)="createOrder()"
  >
    Crear pedido
  </button>

  <!-- Botón Actualizar pedido -->
  <button
    mat-raised-button
    color="accent"
    *ngIf="isEditMode && status !== 'closed'"
    (click)="updateOrder()"
  >
    Actualizar pedido
  </button>

  <!-- Botón Cerrar pedido -->
  <button
    mat-raised-button
    color="primary"
    *ngIf="status !== 'closed' && (status === 'approved' || status === 'preparing')"
    (click)="closeOrder()"
  >
    Cerrar pedido
  </button>
</mat-dialog-actions>
