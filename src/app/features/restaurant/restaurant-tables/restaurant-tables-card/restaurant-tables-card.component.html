<div class="tables-card-container" [class.dark-theme]="isDarkMode">
  <!-- HEADER -->
  <app-section-header
    icon="table_restaurant"
    title="Mesas del Restaurante"
    subtitle="Administra las mesas y crea pedidos rápidamente."
    filterPlaceholder="Buscar mesas..."
    (search)="onSearch($event)"
  >
    <app-add-button
      label="Realizar pedido"
      icon="add_shopping_cart"
      (onClick)="createOrderFromMenu()"
      [isSecondary]="false"
    ></app-add-button>
  </app-section-header>

  <!-- GRID DE MESAS -->
  <div class="cards-wrapper" *ngIf="!loading && filteredTables.length > 0">
    <mat-card
      class="table-card"
      [class.dark-theme]="isDarkMode"
      *ngFor="let t of filteredTables"
    >
      <!-- HEADER -->
      <mat-card-header class="card-header">
        <mat-card-title>Mesa {{ t.number }}</mat-card-title>
        <span
          *ngIf="getOrderStatusLabel(t)"
          class="order-status"
          [style.backgroundColor]="getOrderStatusColor(t)"
        >
          {{ getOrderStatusLabel(t) }}
        </span>
      </mat-card-header>

      <!-- INFO -->
      <mat-card-content class="card-info">
        <span><mat-icon>people</mat-icon> Capacidad: {{ t.capacity }}</span>
        <span><mat-icon>place</mat-icon> Sector: {{ t.sector || "-" }}</span>
      </mat-card-content>

      <!-- ICONOS DE ACCIONES -->
      <mat-card-actions class="card-icons">
        <button
          mat-icon-button
          matTooltip="Cambiar estado"
          [matMenuTriggerFor]="menu"
        >
          <mat-icon>swap_horiz</mat-icon>
        </button>

        <mat-menu #menu="matMenu">
          <button mat-menu-item (click)="changeStatus(t, 'available')">
            Disponible
          </button>
          <button mat-menu-item (click)="changeStatus(t, 'seated')">
            Cliente sentado
          </button>
          <button mat-menu-item (click)="changeStatus(t, 'occupied')">
            Ocupada
          </button>
          <button mat-menu-item (click)="changeStatus(t, 'reserved')">
            Reservada
          </button>
          <mat-divider></mat-divider>
        </mat-menu>

        <button
          mat-icon-button
          color="accent"
          matTooltip="Ver QR"
          (click)="openQr(t)"
        >
          <mat-icon>qr_code</mat-icon>
        </button>
      </mat-card-actions>

      <!-- BOTÓN PRINCIPAL -->
      <mat-card-actions class="card-footer">
        <app-add-button
          class="full-width-btn"
          label="{{
            t.currentOrderId ? 'Ver / Editar Pedido' : 'Crear Pedido'
          }}"
          icon="add_shopping_cart"
          (onClick)="viewOrder(t.currentOrderId ?? null, t)"
          [isSecondary]="true"
          [disabled]="
            !t.currentOrderId &&
            !(t.status === 'available' || t.status === 'seated')
          "
        ></app-add-button>
      </mat-card-actions>
    </mat-card>
  </div>

  <!-- EMPTY STATE -->
  <div *ngIf="!loading && filteredTables.length === 0" class="empty-state">
    <p>No hay mesas registradas.</p>
  </div>
</div>
